# 멱등성

## Async 통신의 한계
- 물리적인 한계로 필연적으로 두 번 이상 데이터를 받을 가능성이 존재합니다.

**Logging Pipeline**
- Log Write to File -> File Scraping -> Pipeline -> Indexing -> Kibana
- 누락이 있으면 안 되니 Async로 구성하기 어렵다.

**백그라운드에서 동작하면서 이후에 처리를 볼 수 있는 서비스**
- Async 통신을 쓰면 됨

## Async 통신에서의 멱등성 보장
- 특정 호출이 1번 여러번 호출이 되어도 서버의 상태는 1번 호출 된 것과 같아야 합니다.
- 멱등성 보장을 위해서는 단순 예제로 RDB를 활용해서 간단하게 쓸 수 있습니다.
- queue_log 라는 Table을 두고 각 트랜잭션에 대한 ID를 두고 이벤트를 관리하면 되겠죠.
- **Message Produce 시**에는 이미 동일한 message_id가 있는지 확인하고 처리
- **Message Consume 시**에는 message_id 확인하고 만일 처리된 경우, 처리중인 상태라면 중복처리로 에러 및 스킵 처리
- 처리 되지 않은 경우 해당 message_id를 처리중으로 바꿔주기

## 멱등성이 보장된 메세징 솔루션

- 메세지 큐잉은 기본적으로 멱등성을 보장하지 못하고 멱등성을 보장하는 프로세스를 내장하는 서비스는 필연적으로 성능의 저하가 있다.
- **단순히, Exactly Once가 구현되어 있네로 끝낼 것이 아닌 내부적으로 추가 인프라 서비스가 되고 있음을 유의해야 함**


### 결론
- Async 통신의 한계가 분명하나 가지는 장점이 한계를 넘기 때문에 멱등성을 식별하는 로직을 추가 구현하더라도 사용 할 수 있어야 한다.
